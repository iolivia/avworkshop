<!-- App wide includes -->
{% include "player_app/page_includes.html" %}

<!-- Page container  -->
<div class="container-fluid">

    <!-- Header -->
    {% include "player_app/header.html" with app_name=app_name only %}

    <div>
        <div class="row justify-content-md-center">

            <div class="row player">
                <video controls width=100%></video>
            </div>

        </div>
    </div>

    <!-- Footer -->
    {% include "player_app/footer.html" with footer_text=footer_text only %}

</div>

<script type="text/javascript">
    (function () {

        // TODO: put your code here 

        function onFragmentDownloaded() {
            console.log(this.response);
        }

        function downloadFragment(url, callback) {
            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", callback);
            oReq.open("GET", url);
            oReq.responseType = "arraybuffer";
            oReq.send();
        }

        function setupMediaSource(videoElement, onMediaSourceOpen) {
            if ('MediaSource' in window) {
                // Create the media source
                var mediaSource = new MediaSource();
                videoElement.src = URL.createObjectURL(mediaSource);

                // Setup open event handler
                mediaSource.addEventListener('sourceopen', onMediaSourceOpen);
            } else {
                console.error("MediaSource not available");
            }
        }

        function onMediaSourceOpen() {
            console.log("MediaSource is open");
        }

        var urlBase = "http://www.bok.net/dash/tears_of_steel/cleartext/$RepresentationID$/seg-$Number$.m4f";
        urlBase = urlBase.replace("$RepresentationID$", "video/1");
        urlBase = urlBase.replace("$Number$", "1");

        downloadFragment(urlBase, onFragmentDownloaded);

        var videoElement = document.querySelector('video');
        setupMediaSource(videoElement, onMediaSourceOpen);

    })();

</script>